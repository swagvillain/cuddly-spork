<!DOCTYPE html>
{% load static %}

<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="{% static 'style.css'  %}">
    <link href="https://fonts.googleapis.com/css2?family=Comic+Neue:wght@400;700&display=swap" rel="stylesheet">
    <title>Ghoti</title>
    <link rel="stylesheet" href="./style.css">
    <link rel="icon" href="/static/favicon.ico" type="image/x-icon">

  <style>
    body, html {
        height: 100%;
        margin: 0;
        overflow: hidden
    }
    .bg {
        background-image: url("{% static 'black_background.jpg' %}");

        height: 100%;

        background-position: center;
        background-repeat: no-repeat;
        background-size: cover;
    }
    .redCar {
        height: 10px;
        width: 10px;
    }
    .question_icon {
        height: 20px;
        width: 20px;
    }
    dialog {
        position: absolute;
        align-items: center;
        height: 100px;
    }
    </style>

  </head>
  <body onload="speak('Here we go! it\'s on like Dankey Kang!')">
    <main style="color:white;">
	    <div class="bg">
        <h1 style="text-align: center;">Race Time</h1>  
	    <br>
    <div id="info">
       	<div class="score1" id="score1"> Player 1 Score: 0 </div>
            <br>
            <div class="score2" id="score2">Player 2 Score: 0</div>
    	<br>
            <div class="score3" id="score3">AI Player Score: 0</div>
    

        <button
                class="btn btn-primary"
		onclick="speak('Sorry, this functionality is not yet available. Please try again at a later date.')"
		onmouseover="speak('You want to pause the game?')"
        >
	Pause/menu
        </button>

        <button
                class="btn btn-primary"
                onclick="window.location.href='{% url 'mainmenu' %}';"
        >
	Exit to Main Menu
        </button>
    </div>

        <!-- dialog content -->
        <dialog id = "dialog">
                <center>
                Answer The Math Problem!

                <div id="math"> Math Question</div>

                <input id = "answer" type="text" autofocus>
                <br>
                <br>
                <button id="submit"> Submit Answer </button>
                </center>
                
        </dialog>
    <div class = "question_icon"> <img id = question width = 35 src="{% static 'question.png' %}"> </img> </div>

    <div class = "redCar"> <img id = rcar width = 50 src="{% static 'RedCar.png' %}"> </img> </div>
    </div>
    </main>
  </body>

<script>
        let rcar = document.getElementById('rcar');
        let speed = 10;
        let question = document.getElementById('question');

        let s1 = document.getElementById("score1");
        let s2 = document.getElementById("score2");
        let p1_score = 0;
        let p2_score = 0;
        let user_answer = document.getElementById("answer");
        let submit_button = document.getElementById("submit");
        let math = document.getElementById("math");


        let car_border = rcar.getBoundingClientRect();

        let q_border = question.getBoundingClientRect();
        
        let dialog = document.getElementById("dialog");
        let box_open = false;


        window.addEventListener('load', () => {
                rcar.style.position = 'absolute';
                rcar.style.left = 100 + 'px';
                rcar.style.top = 100 + 'px';
                rcar.style.transform = '';

        
                question.style.position = 'absolute';
                question.style.top = 200 + 'px';
                question.style.left = 200 + 'px';
                question.style.padding = 0;
                question.style.border = 0;
                question.style.margin = 0;
        })

        
        window.addEventListener('keydown', (e) => {

                switch (e.key){
                        case 'ArrowRight':
                                if(box_open == false){
                                rcar.style.left = parseInt(rcar.style.left) + speed + 'px';
                                rcar.style.transform = "rotate(90deg)";
                                car_border = rcar.getBoundingClientRect();
                                console.log(car_border)
                                q_border = question.getBoundingClientRect();
                                console.log(q_border)
                                
                                if((!(car_border.left > q_border.right || car_border.right < q_border.left || car_border.bottom < q_border.top || car_border.top > q_border.bottom))){
                                        
                                        box_open = true;
                                        math.textContent = RandInt() + "+" + RandInt();
                                        dialog.showModal();

                                        submit_button.addEventListener("click", () => {
                                                console.log(user_answer);
                                                dialog.close();
                                                let answer_key = eval(math.textContent);

                                                if(answer_key == user_answer.value){
                                                        p1_score ++;
                                                }
                                                s1.textContent = "Player 1 Score: " + p1_score;
                                                question.style.top = RandY() + 'px';
                                                question.style.left = RandX() + 'px';
                                                box_open = false;
                                        });

                                        
                                }
                                break;
                                }
                        case 'ArrowLeft':
                                if(box_open == false){
                                rcar.style.left = parseInt(rcar.style.left) - speed + 'px';
                                rcar.style.transform = "rotate(-90deg)";
                                car_border = rcar.getBoundingClientRect();
                                console.log(car_border)
                                q_border = question.getBoundingClientRect();
                                console.log(q_border)
                                if(!(car_border.left > q_border.right || car_border.right < q_border.left || car_border.bottom < q_border.top || car_border.top > q_border.bottom)){
                                        dialog.showModal();
                                }
                                
                                break;
                                }
                        case 'ArrowUp':
                                if(box_open == false){
                                rcar.style.top = parseInt(rcar.style.top) - speed + 'px';
                                rcar.style.transform = "rotate(0deg)";
                                car_border = rcar.getBoundingClientRect();
                                console.log(car_border)
                                q_border = question.getBoundingClientRect();
                                console.log(q_border)
                                if(!(car_border.left > q_border.right || car_border.right < q_border.left || car_border.bottom < q_border.top || car_border.top > q_border.bottom)){
                                        dialog.showModal();
                                }
                                break;
                                }
                        case 'ArrowDown':
                                if(box_open == false){
                                rcar.style.top = parseInt(rcar.style.top) + speed + 'px';
                                rcar.style.transform = "rotate(180deg)";
                                car_border = rcar.getBoundingClientRect();
                                console.log(car_border)
                                q_border = question.getBoundingClientRect();
                                console.log(q_border)
                                if(!(car_border.left > q_border.right || car_border.right < q_border.left || car_border.bottom < q_border.top || car_border.top > q_border.bottom)){
                                        dialog.showModal();
                                }
                                break;
                                }

                }

                function RandInt(){
                        return Math.floor(Math.random() * 11);
                }

                function RandX(){
                        return Math.floor(Math.random() * 1400)
                }

                function RandY(){
                        return Math.floor(Math.random() * 650)
                }

        });
        


    </script>

  <script src="{% static 'js/tts.js' %}"></script>
</html>

